# SOFA and MELD

These notes are intended to offer some perspectives on the design and use of of MELD ideas raised by work on the SOFA Ontological Fragment Assembler (SOFA) application.  They are not intended to be a comprehensive description of SOFA or MELD.


# What is SOFA?

SOFA Ontological Fragment Assembler (SOFA) is an application for assembling elements, or "fragments", into a composed whole.  

![Overview of SOFA](./diagrams/how-sofa-really-works.svg)

It was initially conceived as a tool for guided assembly of musical fragments (generated by David De Roure's _Numbers into Notes_) into musical compositions that obey certain musical rules.  The initial implementation focused on a very small set of musical rules (key compatibility of fragments used, selection of fragments playable within the pitch range of a selected instrument, duration compatibility of fragments to be played together), but the underlying design was intended to allow arbitrary additional criteria to be applied.

A second application based on the SOFA ideas was considered, which would re-implement musical analyses presented by rCALMA using SOFA (and MELD) designs.  rCALMA is a tool for comparing musical variations over multiple live performances of a song in the Live Music Archive.  Some components for this application were implemented, which contributed some lessons to the [SOFA architecture design](https://github.com/oerc-music/nin-remixer-public/blob/master/notes/SOFA-architecture-notes.md), but a full re-implementation was not completed.


# How does SOFA work?

<<@@diagram>>

SOFA allows a user to assemble "fragments" into some composed output.  Composition structures considered to date include:

* a 2-dimensional grid for a musical composition. Rows correspond to instruments or "voices", columns correspond to segments of the overall composition, and cells correspond to musical fragments selected from a supplied working set.
* a linear array, representing a set of musicological analyses.  Each element corresponds to a live performances a song, and presents a musicological analysis and indication of typicality of that performance, where SOFA handles guided selection of the song and musical analyses used for comparison.

Typical SOFA operation includes the following, possibly with arbitrary ordering and repetition:

1. accumulation of a working set of fragments to be considered (e.g. a set of musical fragments generated by Numbers into Notes)
2. establish initial criteria for the composition to be assembled (e.g. an ensemble of instruments to be used)
3. selection of fragments to be included in  the resulting composition
4. assembly of selected fragments into a composition structure
5. final rendering/output of the assembled composition

Steps 1 and 5 are very application and context dependent.  Steps 2, 3 and 4 are potentially quite generic, and SOFA uses MELD ideas and structures to represent some of these generic aspects.

Central to SOFA is a notion of "fragment compatibility" - this may mean compatibility with some established criteria (can the notes in this fragment be played by this instrument?), or compatibility with previously selected fragments (do these musical fragments use a compatible key signature?).

SOFA separates the analysis of fragment compatibility from the guided user interactions that select compatible fragments for the composed result.  This separation of concerns is mediated by MELD-based structures.  Analysis is performed by agents that materialize information about fragment compatibility, and fragment assembly is guided using these materialised structures.  This allows the user interaction to take place without specific knowledge of the analyses performed, and the analysis can proceed without regard for specific user interactions.


# MELD infrastructure and patterns

<<@@diagram>>

This is not a comprehensive description of MELD, just a highlight of some elements of MELD that are relevant to SOFA.

* LDP containers
* Web Annotations
* Sequences of elements
* Sessions

[LDP containers](@@@@) are used by MELD for storage of musical linking information.  Many MELD structures are represented using LDP containers of [Web Annotations](@@@@).

A recurring theme in MELD applications is representation of sequences of elements.  These may be musical elements in a work, events related to a musical performance, interaction events associated with a musicological analysis, among any other things.

A MELD session represents a sequence of events that determine a (typically real-time) patterns of interactions with some music-related material.  The nature and consequence of these interactions is not specified; e.g., they may relate to performance choices made about what to play next; user interactions with a multimedia musicological analysis that are used to synchronise multiple analysis displays, etc.


# SOFA use of MELD

<<@@diagram>>

SOFA employs LDP containers and Web Annotations in ways that are intended to be compatible with the way other MELD applications use them.  This aims for use of common support libraries, and in some cases as a basis for exchange of musical information between applications (such as  a working set of musical fragments from Numbers into Notes being consumed by SOFA).

Sequences of fragments is the basis of SOFA composition outputs, which may be used by separate rendering engines.

MELD sessions have not been used by SOFA to date, but they have a potential role to play in the scheduling/triggering of analysis agent activations.

